# BGI script file opcode table

import asdis

offsets = set()

def clear_offsets():
	offsets.clear()

def get_string(code, hdr, addr, *args):
	pos0 = args[0]
	pos1 = code.find(b'\x00', pos0)
	string = code[pos0:pos1].decode('cp932')
	string = asdis.escape(string)
	return string
	
def get_hstring(code, hdr, addr, *args):
	pos0 = args[0]
	pos1 = hdr.find(b'\x00', pos0)
	if all(0x20<=x<0x7F for x in hdr[pos0:pos1]):
		string = hdr[pos0:pos1].decode('ascii')
	else:
		string = ''.join('\\x%02x' % x for x in hdr[pos0:pos1])
	string = asdis.escape(string)
	return string
	
def get_file(code, hdr, addr, *args):
	pos0 = args[0]
	pos1 = code.find(b'\x00', pos0)
	string = code[pos0:pos1].decode('cp932')
	string = asdis.escape(string)
	lno = args[1]
	return string, lno
	
def get_offset(code, hdr, addr, *args):
	offset = args[0]
	offsets.add(offset)
	return offset
	
ops = {
0x000: ('<i', 'ctrl::dword(%d)', None),
0x001: ('<I', 'ctrl::offset(L%05x)', get_offset),
0x002: ('<I', 'ctrl::hoffset(%#x)', None),
0x003: ('<I', 'ctrl::string("%s")', get_string),
0x008: ('<i', 'ctrl::f_008(%d)', None),
0x009: ('<i', 'ctrl::f_009(%d)', None),
0x00A: ('<i', 'ctrl::f_00a(%d)', None),
0x010: ('', 'ctrl::f_010()', None),
0x011: ('', 'ctrl::f_011()', None),
0x018: ('', 'ctrl::jmp()', None),
0x019: ('<I', 'ctrl::je(%#x)', None),
0x01A: ('', 'ctrl::call()', None),
0x01B: ('', 'ctrl::ret()', None),
0x01C: ('', 'ctrl::f_01c()', None),
0x01D: ('', 'ctrl::f_01d()', None),
0x01E: ('', 'ctrl::f_01e()', None),
0x01F: ('', 'ctrl::f_01f()', None),
0x020: ('', 'ctrl::add()', None),
0x021: ('', 'ctrl::sub()', None),
0x022: ('', 'ctrl::mul()', None),
0x023: ('', 'ctrl::div()', None),
0x024: ('', 'ctrl::mod()', None),
0x025: ('', 'ctrl::and()', None),
0x026: ('', 'ctrl::or()', None),
0x027: ('', 'ctrl::xor()', None),
0x028: ('', 'ctrl::not()', None),
0x029: ('', 'ctrl::shl()', None),
0x02A: ('', 'ctrl::shr()', None),
0x02B: ('', 'ctrl::sar()', None),
0x030: ('', 'ctrl::eq()', None),
0x031: ('', 'ctrl::neq()', None),
0x032: ('', 'ctrl::leq()', None),
0x033: ('', 'ctrl::geq()', None),
0x034: ('', 'ctrl::lt()', None),
0x035: ('', 'ctrl::gt()', None),
0x038: ('', 'ctrl::f_038()', None),
0x039: ('', 'ctrl::f_039()', None),
0x03A: ('', 'ctrl::f_03a()', None),
0x03F: ('<i', 'ctrl::nargs(%d)', None),
0x040: ('', 'ctrl::f_040()', None),
0x048: ('', 'ctrl::f_048()', None),
0x07F: ('<Ii', 'ctrl::line("%s", %d)', get_file),
0x080: ('', 'ctrl::f_080()', None),
0x081: ('', 'ctrl::f_081()', None),
0x082: ('', 'ctrl::f_082()', None),
0x083: ('', 'ctrl::f_083()', None),
0x090: ('', 'ctrl::f_090()', None),
0x091: ('', 'ctrl::f_091()', None),
0x092: ('', 'ctrl::f_092()', None),
0x093: ('', 'ctrl::f_093()', None),
0x094: ('', 'ctrl::f_094()', None),
0x095: ('', 'ctrl::f_095()', None),
0x098: ('', 'ctrl::f_098()', None),
0x099: ('', 'ctrl::f_099()', None),
0x0A0: ('', 'ctrl::f_0a0()', None),
0x0A8: ('', 'ctrl::f_0a8()', None),
0x0AA: ('', 'ctrl::f_0aa()', None),
0x0AC: ('', 'ctrl::f_0ac()', None),
0x0E0: ('', 'ctrl::f_0e0()', None),
0x0E1: ('', 'ctrl::f_0e1()', None),
0x0E2: ('', 'ctrl::f_0e2()', None),
0x0E3: ('', 'ctrl::f_0e3()', None),
0x0E4: ('', 'ctrl::f_0e4()', None),
0x0E5: ('', 'ctrl::f_0e5()', None),
0x0E6: ('', 'ctrl::f_0e6()', None),
0x0E7: ('', 'ctrl::f_0e7()', None),
0x0E8: ('', 'ctrl::f_0e8()', None),
0x0EA: ('', 'ctrl::f_0ea()', None),
0x0EB: ('', 'ctrl::f_0eb()', None),
0x0EC: ('', 'ctrl::f_0ec()', None),
0x0F0: ('', 'ctrl::f_0f0()', None),
0x0F1: ('', 'ctrl::f_0f1()', None),
0x0F3: ('', 'ctrl::f_0f3()', None),
0x0F4: ('', 'ctrl::f_0f4()', None),
0x0F5: ('', 'ctrl::f_0f5()', None),
0x0F6: ('', 'ctrl::f_0f6()', None),
0x0F7: ('', 'ctrl::f_0f7()', None),
0x0F8: ('', 'ctrl::f_0f8()', None),
0x0F9: ('', 'ctrl::f_0f9()', None),
0x0FA: ('', 'ctrl::f_0fa()', None),
0x0FC: ('', 'ctrl::f_0fc()', None),
0x0FE: ('', 'ctrl::f_0fe()', None),
0x0FF: ('', 'ctrl::f_0ff()', None),

0x100: ('', 'sys_::f_100()', None),
0x101: ('', 'sys_::f_101()', None),
0x108: ('', 'sys_::f_108()', None),
0x10F: ('', 'sys_::f_10f()', None),
0x110: ('', 'sys_::f_110()', None),
0x111: ('', 'sys_::f_111()', None),
0x112: ('', 'sys_::f_112()', None),
0x113: ('', 'sys_::f_113()', None),
0x114: ('', 'sys_::f_114()', None),
0x116: ('', 'sys_::f_116()', None),
0x117: ('', 'sys_::f_117()', None),
0x118: ('', 'sys_::f_118()', None),
0x119: ('', 'sys_::f_119()', None),
0x11A: ('', 'sys_::f_11a()', None),
0x11B: ('', 'sys_::f_11b()', None),
0x11C: ('', 'sys_::f_11c()', None),
0x120: ('', 'sys_::f_120()', None),
0x121: ('', 'sys_::f_121()', None),
0x122: ('', 'sys_::f_122()', None),
0x123: ('', 'sys_::f_123()', None),
0x124: ('', 'sys_::f_124()', None),
0x125: ('', 'sys_::f_125()', None),
0x128: ('', 'sys_::f_128()', None),
0x12C: ('', 'sys_::f_12c()', None),
0x12F: ('', 'sys_::f_12f()', None),
0x130: ('', 'sys_::f_130()', None),
0x131: ('', 'sys_::f_131()', None),
0x132: ('', 'sys_::f_132()', None),
0x136: ('', 'sys_::f_136()', None),
0x137: ('', 'sys_::f_137()', None),
0x138: ('', 'sys_::f_138()', None),
0x139: ('', 'sys_::f_139()', None),
0x13A: ('', 'sys_::f_13a()', None),
0x13B: ('', 'sys_::f_13b()', None),
0x13C: ('', 'sys_::f_13c()', None),
0x13D: ('', 'sys_::f_13d()', None),
0x13F: ('', 'sys_::f_13f()', None),

0x140: ('', 'msg_::f_140()', None),
0x141: ('', 'msg_::f_141()', None),
0x142: ('', 'msg_::f_142()', None),
0x143: ('', 'msg_::f_143()', None),
0x144: ('', 'msg_::f_144()', None),
0x145: ('', 'msg_::f_145()', None),
0x146: ('', 'msg_::f_146()', None),
0x147: ('', 'msg_::f_147()', None),
0x148: ('', 'msg_::f_148()', None),
0x149: ('', 'msg_::f_149()', None),
0x14A: ('', 'msg_::f_14a()', None),
0x14B: ('', 'msg_::f_14b()', None),
0x14C: ('', 'msg_::f_14c()', None),
0x14D: ('', 'msg_::f_14d()', None),
0x14E: ('', 'msg_::f_14e()', None),
0x14F: ('', 'msg_::f_14f()', None),
0x150: ('', 'msg_::f_150()', None),
0x151: ('', 'msg_::f_151()', None),
0x152: ('', 'msg_::f_152()', None),
0x153: ('', 'msg_::f_153()', None),
0x157: ('', 'msg_::f_157()', None),
0x158: ('', 'msg_::f_158()', None),
0x159: ('', 'msg_::f_159()', None),
0x15C: ('', 'msg_::f_15c()', None),
0x15D: ('', 'msg_::f_15d()', None),
0x15E: ('', 'msg_::f_15e()', None),
0x15F: ('', 'msg_::f_15f()', None),

0x160: ('', 'slct::f_160()', None),
0x161: ('', 'slct::f_161()', None),
0x164: ('', 'slct::f_164()', None),
0x165: ('', 'slct::f_165()', None),
0x166: ('', 'slct::f_166()', None),
0x168: ('', 'slct::f_168()', None),
0x169: ('', 'slct::f_169()', None),
0x16C: ('', 'slct::f_16c()', None),
0x170: ('', 'slct::f_170()', None),

0x180: ('', 'snd_::f_180()', None),
0x181: ('', 'snd_::f_181()', None),
0x184: ('', 'snd_::f_184()', None),
0x185: ('', 'snd_::f_185()', None),
0x186: ('', 'snd_::f_186()', None),
0x190: ('', 'snd_::f_190()', None),
0x191: ('', 'snd_::f_191()', None),
0x194: ('', 'snd_::f_194()', None),
0x195: ('', 'snd_::f_195()', None),
0x196: ('', 'snd_::f_196()', None),
0x198: ('', 'snd_::f_198()', None),
0x199: ('', 'snd_::f_199()', None),
0x19C: ('', 'snd_::f_19c()', None),
0x19D: ('', 'snd_::f_19d()', None),
0x19E: ('', 'snd_::f_19e()', None),
0x1A0: ('', 'snd_::f_1a0()', None),
0x1A1: ('', 'snd_::f_1a1()', None),
0x1A2: ('', 'snd_::f_1a2()', None),
0x1A3: ('', 'snd_::f_1a3()', None),
0x1A4: ('', 'snd_::f_1a4()', None),
0x1A5: ('', 'snd_::f_1a5()', None),
0x1A6: ('', 'snd_::f_1a6()', None),
0x1A7: ('', 'snd_::f_1a7()', None),
0x1A8: ('', 'snd_::f_1a8()', None),
0x1A9: ('', 'snd_::f_1a9()', None),
0x1AA: ('', 'snd_::f_1aa()', None),
0x1AC: ('', 'snd_::f_1ac()', None),
0x1BF: ('', 'snd_::f_1bf()', None),

0x220: ('', 'grp_::f_220()', None),
0x222: ('', 'grp_::f_222()', None),
0x228: ('', 'grp_::f_228()', None),
0x229: ('', 'grp_::f_229()', None),
0x22A: ('', 'grp_::f_22a()', None),
0x230: ('', 'grp_::f_230()', None),
0x231: ('', 'grp_::f_231()', None),
0x232: ('', 'grp_::f_232()', None),
0x233: ('', 'grp_::f_233()', None),
0x234: ('', 'grp_::f_234()', None),
0x235: ('', 'grp_::f_235()', None),
0x236: ('', 'grp_::f_236()', None),
0x237: ('', 'grp_::f_237()', None),
0x238: ('', 'grp_::f_238()', None),
0x239: ('', 'grp_::f_239()', None),
0x23C: ('', 'grp_::f_23c()', None),
0x23D: ('', 'grp_::f_23d()', None),
0x240: ('', 'grp_::f_240()', None),
0x241: ('', 'grp_::f_241()', None),
0x242: ('', 'grp_::f_242()', None),
0x244: ('', 'grp_::f_244()', None),
0x245: ('', 'grp_::f_245()', None),
0x248: ('', 'grp_::f_248()', None),
0x24C: ('', 'grp_::f_24c()', None),
0x24D: ('', 'grp_::f_24d()', None),
0x24E: ('', 'grp_::f_24e()', None),
0x258: ('', 'grp_::f_258()', None),
0x25E: ('', 'grp_::f_25e()', None),
0x25F: ('', 'grp_::f_25f()', None),
0x260: ('', 'grp_::f_260()', None),
0x262: ('', 'grp_::f_262()', None),
0x266: ('', 'grp_::f_266()', None),
0x268: ('', 'grp_::f_268()', None),
0x27F: ('', 'grp_::f_27f()', None),
0x280: ('', 'grp_::f_280()', None),
0x281: ('', 'grp_::f_281()', None),
0x284: ('', 'grp_::f_284()', None),
0x288: ('', 'grp_::f_288()', None),
0x289: ('', 'grp_::f_289()', None),
0x28a: ('', 'grp_::f_28a()', None),
0x290: ('', 'grp_::f_290()', None),
0x2C0: ('', 'grp_::f_2c0()', None),
0x2C1: ('', 'grp_::f_2c1()', None),
0x2C2: ('', 'grp_::f_2c2()', None),
0x2C3: ('', 'grp_::f_2c3()', None),
0x2C4: ('', 'grp_::f_2c4()', None),
0x2C5: ('', 'grp_::f_2c5()', None),
0x2C6: ('', 'grp_::f_2c6()', None),
0x2C7: ('', 'grp_::f_2c7()', None),
0x2C8: ('', 'grp_::f_2c8()', None),
0x2CA: ('', 'grp_::f_2ca()', None),
0x2CB: ('', 'grp_::f_2cb()', None),
0x2CC: ('', 'grp_::f_2cc()', None),
0x2CE: ('', 'grp_::f_2ce()', None),
0x2CF: ('', 'grp_::f_2cf()', None),
0x2D0: ('', 'grp_::f_2d0()', None),
0x2D2: ('', 'grp_::f_2d2()', None),
0x2D8: ('', 'grp_::f_2d8()', None),
0x2DC: ('', 'grp_::f_2dc()', None),
0x2DF: ('', 'grp_::f_2df()', None),
0x2E0: ('', 'grp_::f_2e0()', None),
0x2E2: ('', 'grp_::f_2e2()', None),
0x2E4: ('', 'grp_::f_2e4()', None),
0x2E8: ('', 'grp_::f_2e8()', None),
0x2E9: ('', 'grp_::f_2e9()', None),
0x2EA: ('', 'grp_::f_2ea()', None),
0x2F0: ('', 'grp_::f_2f0()', None),
0x2F8: ('', 'grp_::f_2f8()', None),
0x300: ('', 'grp_::f_300()', None),
0x301: ('', 'grp_::f_301()', None),
0x302: ('', 'grp_::f_302()', None),
0x303: ('', 'grp_::f_303()', None),
0x304: ('', 'grp_::f_304()', None),
0x306: ('', 'grp_::f_306()', None),
0x307: ('', 'grp_::f_307()', None),
0x308: ('', 'grp_::f_308()', None),
0x309: ('', 'grp_::f_309()', None),
0x30C: ('', 'grp_::f_30c()', None),
0x30E: ('', 'grp_::f_30e()', None),
0x31F: ('', 'grp_::f_31f()', None),
0x320: ('', 'grp_::f_320()', None),
0x328: ('', 'grp_::f_328()', None),
0x32C: ('', 'grp_::f_32c()', None),
0x33F: ('', 'grp_::f_33f()', None),
0x340: ('', 'grp_::f_340()', None),
0x348: ('', 'grp_::f_348()', None),
0x350: ('', 'grp_::f_350()', None),
0x351: ('', 'grp_::f_351()', None),
0x352: ('', 'grp_::f_352()', None),
0x353: ('', 'grp_::f_353()', None),
0x358: ('', 'grp_::f_358()', None),
0x380: ('', 'grp_::f_380()', None),
0x388: ('', 'grp_::f_388()', None),
0x390: ('', 'grp_::f_390()', None),
0x391: ('', 'grp_::f_391()', None),
0x392: ('', 'grp_::f_392()', None),
0x393: ('', 'grp_::f_393()', None),
0x394: ('', 'grp_::f_394()', None),
0x3AF: ('', 'grp_::f_3af()', None),
0x3C0: ('', 'grp_::f_3c0()', None),
0x3C1: ('', 'grp_::f_3c1()', None),
0x3C2: ('', 'grp_::f_3c2()', None),
0x3C4: ('', 'grp_::f_3c4()', None),
0x3C5: ('', 'grp_::f_3c5()', None),
0x3C6: ('', 'grp_::f_3c6()', None),
0x3C7: ('', 'grp_::f_3c7()', None),
0x3C8: ('', 'grp_::f_3c8()', None),
0x3C9: ('', 'grp_::f_3c9()', None),
0x3D0: ('', 'grp_::f_3d0()', None),
0x3D2: ('', 'grp_::f_3d2()', None),
0x3D4: ('', 'grp_::f_3d4()', None),
0x3D5: ('', 'grp_::f_3d5()', None),
0x3D6: ('', 'grp_::f_3d6()', None),
0x3D8: ('', 'grp_::f_3d8()', None),
0x3DC: ('', 'grp_::f_3dc()', None),
0x3F0: ('', 'grp_::f_3f0()', None),
0x3F1: ('', 'grp_::f_3f1()', None),
}
